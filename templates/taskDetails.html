{% extends "project_base.html" %}


{% block body %}
<link rel="stylesheet" href="/static/taskDetails.css">
<header>
    <button onclick="window.location.href='/home'">back</button>
    <h1>Task Details</h1>
    <button>rewrite</button>
</header>
<main>
    <div id="titleInfo">
        <h1>{{ taskDetails.title }}</h1>
        <span class="text2">Created at: {{ taskDetails.created_at }}</span>
        <span class="text2">Created by: {{ taskDetails.created_by }}</span>
    </div>

    <div id="timeandteam">
        <div class="dateTeam">
            <div id="calendar"></div>
            <div class="info">
                <span class="text2">Due to</span>
                <span class="text">{{ taskDetails.date }}, {{ taskDetails.time }}</span>
            </div>
        </div>

        <div class="dateTeam">
            <div id="users"></div>
            <div class="info">
                <span class="text2">Project team</span>
                <span class="text">peoples</span>
            </div>
        </div>
    </div>

    <div id="description">
        <span class="text">Description</span>
        <span class="text2">{{ taskDetails.description }}</span>
    </div>

    <div id="progress">
        <span class="text">Project Progress</span>
        <div id="outter"><span id="precent">0%</span></div>
    </div>

    <div id="under-tasks">
        <span class="text">All Tasks</span>
        <div id="UTbox"></div>
    </div>

    <button id="delete" onclick="deleteTask()">Delete</button>
<!-- Task details, Complete the status part later, maybe add a button to change the status of the task
            <span>{{ taskDetails.status }}</span>
-->
</main>

<!-- Script for under tasks-->
<script>
    let utarr = {{ taskDetails.UT|safe }};
    let Utbox = document.getElementById("UTbox");

    utarr.forEach(item => {
        let box = document.createElement("div")
        box.innerHTML=`
            <span class="UTtext">${item}</span>
            <label class="check-label"><input type="checkbox" class="check" onclick=""></label>
        `
        box.setAttribute("id", `${item}`)
        box.setAttribute("class", "UT")
        Utbox.appendChild(box);
    });
</script>
    

<!-- Script for progress bar -->
<script>
    let capacity = utarr.length
    let input = document.querySelectorAll(".check")
    let inputCap = 0
    input.forEach(item => {
        item.addEventListener("click", () => {
            if (item.checked == true){
                inputCap += 1
            }
            else if (item.checked == false){
                inputCap -= 1
            }

            let precent = document.getElementById("precent")
            let precentMath = Math.round((inputCap / utarr.length) * 100)
            precent.innerHTML = `${precentMath}%`

            let outter = document.getElementById("outter")
            outter.style.borderImage = `conic-gradient(#FED36A ${precentMath}%, #2C4653 0) 1`
        })
    })
</script>

<!-- Script for deletion-->
<script>
    async function deleteTask() {
        let res = await fetch("/deleteTask", {
                method: "POST",
                headers: { "Content-Type": "application/json"},
                body: JSON.stringify({
                    id: {{ taskDetails.id }}
                })
            })
    }
</script>
{% endblock body %}